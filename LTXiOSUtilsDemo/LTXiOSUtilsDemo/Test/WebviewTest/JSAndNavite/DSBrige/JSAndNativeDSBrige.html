<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSBrige</title>
</head>

<body>
    <p>同步调用Native</p>
    <button onclick="callNativeSync()">同步调用</button>

    <p>异步调用Native</p>
    <button onclick="callNativeAsync()">异步调用</button>

    <p>执行window.close()</p>
    <button onclick="window.close()">执行</button>

    <p>调用Native获取进度回调</p>
    <button onclick="callNativeProgress()">获取进度</button>
    <h1 id="progress"></h1>

</body>
<script src="https://cdn.jsdelivr.net/npm/dsbridge/dist/dsbridge.js"> </script>
<script>
    // 调用原生，调用时如果不需传递参数给原生，则可以直接省略第二个参数

    // 同步调用原生
    function callNativeSync() {
        // app.common为 原生注册的namespace，callNativeSync为方法名
        var info = {
            "type": "同步",
            "message": "从JS发来的同步数据参数"
        }
        var result = dsBridge.call("app.common.callNativeSync", info)
        alert(JSON.stringify(result))
    }

    // 异步调用原生
    function callNativeAsync() {
        var info = {
            "type": "异步",
            "message": "从JS发来的异步数据参数"
        }
        dsBridge.call("app.common.callNativeAsync", info, function (v) {
            alert(JSON.stringify(v))
        })
        console.log("调用原生获取返回值之前的显示")
    }

    // 获取原生进度
    function callNativeProgress() {
        dsBridge.call("app.common.callProgress", function (value) {
            document.getElementById("progress").innerText = value
        })
    }


    // 注册JS方法供原生调用

    // 供原生同步调用
    dsBridge.register('callJSSync', function (arg1, arg2) {
        alert(arg1 + "  " + arg2)
        return "这是Native调用JS方法获取到的信息，同步"
    })

    // 供原生异步调用
    // responseCallback
    dsBridge.registerAsyn('callJSAsync', function (arg1, arg2, responseCallback) {
        alert(arg1 + "  " + arg2)
        var t = 0
        var timer = setInterval(function () {
            var info = "这是Native调用JS方法获取到的信息，异步，变化数量为：" + t
            if (t == 5) {
                responseCallback(info)
                clearInterval(timer)
            } else {
                t++
                responseCallback(info, false)
            }
        }, 1000)
    })

    // 注册方法时，设置命名空间
    dsBridge.register("js.callJSSyncNameSpace", {
        method1: function (arg1, arg2) {
            alert(arg1 + "  " + arg2)
            return "调用JS的方法成功，方法1，同步"
        },
        method2: function () {
            return "调用JS的方法成功，方法2，同步"
        }
    })

    dsBridge.registerAsyn("js.callJSAsyncNameSpace", {
        method1: function (arg1, arg2, responseCallback) {
            console.log(arg1 + "  " + arg2)
            responseCallback("调用JS的方法成功，方法1，异步");
        },
        method2: function (responseCallback) {
            responseCallback("调用JS的方法成功，方法2，异步");
        }
    })
</script>

</html>